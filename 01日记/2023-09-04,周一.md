

## 今日任务

### 蓝牙Mesh总结

蓝牙Mesh采用分布式控制架构，能够实现更大规模、更高可靠性和更低的成本。  

其传播方式是基于洪泛（flooding）的机制，一种通过低功耗蓝牙广播报文（ADV）实现。采用了消息缓存队列和TTL字段来避免信息被无限转发下去。设备都会缓存收到消息的关键信息，用来确定是否要转发这个消息，如果是的话就忽略这个消息。TTL用来限制中继次数，最大值126次，每次转发一次TTL值就减1。

#### 网络架构
蓝牙的网络架构共包含：模型、基础模型、接入层、上层传输层、底层传输层、网络层、承载层和BLE核心规范；

其中承载层定义如何传输PDU，目前就ADV和GATT承载层；

核心规范中分为Host（主协议层）和控制层，Host中包含了GATT、GAP、ATT等协议，控制层包含了Host Control Interface（HCI）、Link Layer（LL）、Physical Layer（PHY）；

**ATT（Attribute Protocol）**：  
用来定义数据和命令，比如读/写某个数据——数据和命令

**【GAP】Generic Access Profile（通用访问规范）**：  
主要用来进行广播、扫描、发起连接等。对LL做了一些简单的定义和规范；  
建立连接

**【GATT】Generic Attribute Profile通用属性配置**：
GATT：规范和管理Attribute，定义两个BLE设备通过service和Characteristic（特征值）通信  

#### 配网与控制

猫精的整体通信架构：
APP<——>云端<——mqtt——>网关<——>设备

##### 发现设备
1. app发送发现指令到云端
2. 云端下发发送指令到网关
3. 网关接收到设备广播信号并上传到云端
4. 返回设备列表到app。

##### 配网
1. 云端下发配网指令到网关
2. 网关网关GATT与设备进行数据通信
3. 确认、校验验证等
4. 绑定用户
5. 期间还要做负载均衡

通信与上面类似

#### 通信机制
以消息为中心的网络，通过发布/订阅模式

#### 地址类型
单播地址、虚拟地址、群组地址


##### HTTP协议
http协议的特点有：
C/S模式，灵活简单（允许任何类型数据）、无连接、无状态

报文是文本类型，由请求行、请求头、空行和请求数据组成

行里面包含了请求方法、URL、协议版本等
