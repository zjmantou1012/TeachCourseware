---
author: zjmantou
title: 图钉卡片样式
time: 2025-03-25 周二
tags:
  - blog
  - Android
  - UI
---
![image.png](https://zjmantou-drawingbed.oss-cn-hangzhou.aliyuncs.com/picture/202503251530262.png)


由于Android屏幕多样性问题，这种卡片不仅仅高度变化，宽度也会随着变化，如果用图片做的话，会带来拉伸严重变形的问题，另外图片不仅仅占用包体积，而且会占用应用内存，以列表形式展示寝室派对的卡片列表的话，那整个屏幕的应用内存会多出大几十M，因此考虑使用Canvas实现代码绘制效果；

同时通过此原理讲解，分享如何拆解几何图形步骤来实现高级UI；

## API说明

### 画布

Canvas画布提供的方法比较多，大致可以分为几类：
- 基础多几何图形，如rect、圆角rect、圆、椭圆；
- 贝塞尔曲线：画一些曲线常用的二阶、三阶贝塞尔曲线；一般实现高级UI或者弧度会用到，相关的实现方法可以参考[贝塞尔曲线](https://juejin.cn/post/6844903760007790600)
- path：Path是自定义了一个路径，通过canvas将路径画出来；

### 画笔

Paint是Canvas实现画布是使用的画笔，比如基础的颜色、填充方式（填充、线条），离屏绘制（重叠部分模式，[参考文档](https://blog.csdn.net/u013700502/article/details/115055544)）

## 步骤拆解 

要实现自定义的图形，那就必须需要视觉的同学给出相关的参数，这是前提条件，否则我们无法去计算一些坐标，比如左上角旋转的3/4椭圆；

另外，也需要具备勾股定理的相关知识，**勾股定理是计算平面坐标距离非常有效的方法**。

上图可以按照实现步骤拆解为如下：
1. 底部渐变色的圆角方框，旋转角度 `2` 度；
2. 上层白色的圆角方框，旋转角度为0；
3. 裁剪出右上角的线；
4. 实现左上角的圆点；
5. 最后实现左上角3/4椭圆，旋转角度 `50` 度。

上述步骤除了3和5相对计算多一些，其他步骤都是基础几何图形，还是很容易画的，除了要注意步骤1中的旋转角度，这里可能不通平台实现的方式不同，安卓上是通过**先将画布旋转`2`度，然后画圆角矩形，接着再将角度旋转回来**就能实现。

### 步骤3的拆解

![image.png](https://zjmantou-drawingbed.oss-cn-hangzhou.aliyuncs.com/picture/202503251531815.png)


从上图中可以看到，步骤3的整体裁剪形状为一个直角梯形，在三个红框中裁剪出弧度，三个红框从左到右分别为 两个 `二阶贝塞尔曲线` 和 `1/4圆`

这里就需要预先定义好几个参数：
- 直角梯形的上部分宽度和高度；
- 直角梯形斜角角度，这里为45度；
- 两个二阶贝塞尔曲线所需要的控制点；
- 右下角1/4圆的半径；

上述几个参数中，需要多计算的点的位置就二阶贝塞尔曲线的两个控制点的位置，即P1，P2的坐标：

![image.png](https://zjmantou-drawingbed.oss-cn-hangzhou.aliyuncs.com/picture/202503251531380.png)


如上图的框，已知L1 = L2 = 7个像素，且高度已知，我们假设为height，角度也是已知为45度，假设为R1，由勾股定理已知，如果我们知道了 P1 的坐标点，那么P2的坐标点也就可以确定：`P2（x，y） = P1（x+height，y+ height）`
确定了P1，P2的位置之后，那么只需要知道而且贝尔赛曲线的起点坐标，就能够画出两个弧度的大小，两个弧度之间的斜线，只需要通过直线连接即可；
假设弧度的起点为H1和H2，那么`H1(x,y) = P1(x - L1,y)`，H2的坐标点需要经过P2结合勾股定理去做一层转换，还是结合图来看下：

![image.png](https://zjmantou-drawingbed.oss-cn-hangzhou.aliyuncs.com/picture/202503251532380.png)


从上面的公式已经计算出来了P2点的坐标，以及三角形的角度，并且L2的宽度也是已知的，那么T1坐标点形成的也是一个等边直角三角形，那么T1的坐标为：`T1(x,y) = P2(x - z,y - z)` , 其中z的长度计算公式为：`z平方 + z平方 = L2的平方`；

确定了T1和P2之后，即可通过二阶贝塞尔曲线将这个弧线划出来了。

最后总结下整个path的路径：

1. 先move到起始点；
2. 通过P1为控制点画一个二阶贝塞尔曲线；
3. 直线line到T1点；
4. 再通过P2为控制点画一个二阶贝塞尔曲线；
5. 在line到1/4圆的起点；
6. 画一个1/4圆弧；
7. 最后line到白色方框的右上角起点，最后line回一开始的起始点；

这样这个裁剪的图形就实现了！

### 步骤5的拆解

![image.png](https://zjmantou-drawingbed.oss-cn-hangzhou.aliyuncs.com/picture/202503251532671.png)


已知，3/4椭圆的旋转角度为50度，宽高分别为width和height，而且圆点点中心位置P1也是确定的，那么只要知道椭圆的左上角位置，也就是P3，就能画出对应的形状； 

勾股定理中，已知斜角边(Xb)和角度(rotate)之后，那么两个直角边的计算公式分别为：
- 对角边为：`Xb * sin(rotate)`
- 邻角边为：`Xb * cos(rotate)` 

>[!warning] : 这里注意在计算机中，需要把对应的角度转换成弧度在进行勾股计算，Java中通过Math.toRadians()方法进行角度的转换。 

那么我们就能确定P2的点为： 

```java
x1 = height / 2 * sin(toRadians(50))
y1 = height / 2 * cos(toRadians(50))
P2(x,y) = P1(x + x1, y + y1)
```

同理知道P2坐标后，我们就可以计算得到最终点P3的坐标： 

```java
x2 = width * cos(toRadians(50))
y2 = width * sin(toRadians(50))
P3(x,y) = P2(x - x2, y - y2)
```

确定后就可以调用Canvas的椭圆画法最终画出3/4椭圆：

```java
canvas.drawArc(ovalRectF, 0f, 270f, false, paint)
```


## 总结

画图并不难，只需要掌握提供的api和平面几何计算方法，基本上都能实现任何几何图形。

