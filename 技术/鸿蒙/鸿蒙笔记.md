---
author: zjmantou
title: 鸿蒙笔记
time: 2025-02-11 周二
tags:
  - 鸿蒙
  - ArkTs
---
# 架构层 
## HAP/HAR/HSP 应用场景

[聊聊鸿蒙中 HAR 和 HSP 的使用场景](https://blog.csdn.net/chuyouyinghe/article/details/137112624)
## 导航最佳实践 

[应用导航设计](https://developer.huawei.com/consumer/cn/doc/best-practices-V5/bpta-application-navigation-design-V5#section16766824123214) 

# 工程包

## Stage模型与FA模型

[Stage与FA模型区别](https://developer.huawei.com/consumer/cn/forum/topic/0202105111455550468) 

[官方文档](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/application-models-V5)

**Stage模型与FA模型最大的区别在于**：Stage模型中，多个应用组件共享同一个ArkTS引擎实例；而FA模型中，每个应用组件独享一个ArkTS引擎实例。因此在Stage模型中，应用组件之间可以方便的共享对象和状态，同时减少复杂应用运行对内存的占用。Stage模型作为主推的应用模型，开发者通过它能够更加便利地开发出分布式场景下的复杂应用。
# 框架对比

[Navigation VS Router](https://developer.huawei.com/consumer/cn/doc/harmonyos-faqs/faqs-arkui-299-V5) 

# 启动框架AppStartup

![执行时机](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20250217164508.13436724771988996672051024920135:50001231000000:2800:4C67B7A28CCFDFD66BF40793AFB0E3C2FB006C2324C3E1DF75F3E35C7812801A.png?needInitFileName=true?needInitFileName=true)

- 只能在entry 类型的module下
- 不能循环依赖

开发流程：
1. 定义配置文件：module.json5设置appStartup，设置的文件定义在/resources/base/profile
2. 设置启动参数：继承StartupConfigEntry
3. 添加启动任务：继承StartupTask
	1. init方法：初始化，在onDependencyCompleted之后
	2. onDependencyCompleted：前置依赖任务完成后回调

![启动任务依赖关系](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20250217164508.45290987345472904323537132194859:50001231000000:2800:DA9BBECAE4206BBB96EA914F372D58676688801BDE50D5017A2CBB7716029DE2.png?needInitFileName=true?needInitFileName=true)

## 启动框架配置

```json
///resources/base/profile/startup_config.json5
{
  "startupTasks": [
    {
      "name": "StartupTask_001",
      "srcEntry": "./ets/startup/StartupTask_001.ets",
      "dependencies": [
        "StartupTask_002",
        "StartupTask_003"
      ],
      "runOnThread": "taskPool",
      "waitOnMainThread": false
    },
    {
      "name": "StartupTask_002",
      "srcEntry": "./ets/startup/StartupTask_002.ets",
      "dependencies": [
        "StartupTask_004"
      ],
      "runOnThread": "taskPool",
      "waitOnMainThread": false
    },
    {
      "name": "StartupTask_003",
      "srcEntry": "./ets/startup/StartupTask_003.ets",
      "dependencies": [
        "StartupTask_004"
      ],
      "runOnThread": "taskPool",
      "waitOnMainThread": false
    },
    {
      "name": "StartupTask_004",
      "srcEntry": "./ets/startup/StartupTask_004.ets",
      "runOnThread": "taskPool",
      "waitOnMainThread": false
    },
    {
      "name": "StartupTask_005",
      "srcEntry": "./ets/startup/StartupTask_005.ets",
      "dependencies": [
        "StartupTask_006"
      ],
      "runOnThread": "mainThread",
      "waitOnMainThread": true,
      "excludeFromAutoStart": true
    },
    {
      "name": "StartupTask_006",
      "srcEntry": "./ets/startup/StartupTask_006.ets",
      "runOnThread": "mainThread",
      "waitOnMainThread": false,
      "excludeFromAutoStart": true
    }
  ],
  "configEntry": "./ets/startup/StartupConfig.ets"
}

//module.json5配置
{
  "module": {
    "name": "entry",
    "type": "entry",
    // ...
    "appStartup": "$profile:startup_config", // 启动框架的配置文件
    // ...
  }
}
```

## 设置启动参数

```ts
import { StartupConfig, StartupConfigEntry, StartupListener } from '@kit.AbilityKit';
import { hilog } from '@kit.PerformanceAnalysisKit';
import { BusinessError } from '@kit.BasicServicesKit';

export default class MyStartupConfigEntry extends StartupConfigEntry {
  onConfig() {
    hilog.info(0x0000, 'testTag', `onConfig`);
    let onCompletedCallback = (error: BusinessError<void>) => {
      hilog.info(0x0000, 'testTag', `onCompletedCallback`);
      if (error) {
        hilog.info(0x0000, 'testTag', 'onCompletedCallback: %{public}d, message: %{public}s', error.code, error.message);
      } else {
        hilog.info(0x0000, 'testTag', `onCompletedCallback: success.`);
      }
    };
    let startupListener: StartupListener = {
      'onCompleted': onCompletedCallback
    };
    let config: StartupConfig = {
      'timeoutMs': 10000,
      'startupListener': startupListener
    };
    return config;
  }
}
```

## 启动任务

```ts
import { StartupTask, common } from '@kit.AbilityKit';
import { hilog } from '@kit.PerformanceAnalysisKit';

@Sendable
export default class StartupTask_001 extends StartupTask {
  constructor() {
    super();
  }

  async init(context: common.AbilityStageContext) {
    hilog.info(0x0000, 'testTag', 'StartupTask_001 init.');
    return 'StartupTask_001';
  }

  onDependencyCompleted(dependence: string, result: Object): void {
    hilog.info(0x0000, 'testTag', 'StartupTask_001 onDependencyCompleted, dependence: %{public}s, result: %{public}s',
      dependence, JSON.stringify(result));
  }
}
```

## 手动配置

```ts
import { AbilityConstant, UIAbility, Want, startupManager } from '@kit.AbilityKit';
import { hilog } from '@kit.PerformanceAnalysisKit';
import { BusinessError } from '@kit.BasicServicesKit';

export default class EntryAbility extends UIAbility {
  onCreate(want: Want, launchParam: AbilityConstant.LaunchParam): void {
    hilog.info(0x0000, 'testTag', '%{public}s', 'Ability onCreate');
    let startParams = ["StartupTask_005", "StartupTask_006"];
    try {
      startupManager.run(startParams).then(() => {
        console.log('StartupTest startupManager run then, startParams = ');
      }).catch((error: BusinessError) => {
        console.info('StartupTest promise catch error, error = ' + JSON.stringify(error));
        console.info('StartupTest promise catch error, startParams = '
          + JSON.stringify(startParams));
      })
    } catch (error) {
      let errMsg = JSON.stringify(error);
      let errCode: number = error.code;
      console.log('Startup catch error , errCode= ' + errCode);
      console.log('Startup catch error ,error= ' + errMsg);
    }
  }

  // ...
}
```

```ts
import { startupManager } from '@kit.AbilityKit';

@Entry
@Component
struct Index {
  @State message: string = '手动模式';
  @State startParams: Array<string> = ["StartupTask_006"];

  build() {
    RelativeContainer() {
      Button(this.message)
        .id('AppStartup')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .onClick(() => {
          if (!startupManager.isStartupTaskInitialized("StartupTask_006")) { // 判断是否已经完成初始化
            startupManager.run(this.startParams)
          }
        })
        .alignRules({
          center: {anchor: '__container__', align: VerticalAlign.Center},
          middle: {anchor: '__container__', align: HorizontalAlign.Center}
        })
    }
    .height('100%')
    .width('100%')
  }
}
```

# 订阅系统环境变量的变化

- [使用ApplicationContext订阅回调](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/subscribe-system-environment-variable-changes-V5#%E4%BD%BF%E7%94%A8applicationcontext%E8%AE%A2%E9%98%85%E5%9B%9E%E8%B0%83)
- [在AbilityStage组件容器中订阅回调](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/subscribe-system-environment-variable-changes-V5#%E5%9C%A8abilitystage%E7%BB%84%E4%BB%B6%E5%AE%B9%E5%99%A8%E4%B8%AD%E8%AE%A2%E9%98%85%E5%9B%9E%E8%B0%83)
- [在UIAbility组件中订阅回调](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/subscribe-system-environment-variable-changes-V5#%E5%9C%A8uiability%E7%BB%84%E4%BB%B6%E4%B8%AD%E8%AE%A2%E9%98%85%E5%9B%9E%E8%B0%83)
- [在ExtensionAbility组件中订阅回调](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/subscribe-system-environment-variable-changes-V5#%E5%9C%A8extensionability%E7%BB%84%E4%BB%B6%E4%B8%AD%E8%AE%A2%E9%98%85%E5%9B%9E%E8%B0%83)


# 应用间跳转 

两种类型：
- [拉起指定应用](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/app-startup-overview-V5)：
	- 指定应用链接（推荐）：openLink或startAbility
		- Deep Linking：任意形式，容易被其他应用仿冒
		- App Linking：推荐，必须为https，域名校验机制；
	- 指定Ability（不推荐）：startAbility（显式Want方式）
- [拉起指定类型的应用](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/start-intent-panel-V5)：

## 拉起指定应用

**appLinkingOnly**：是否必须以App Linking方式启动，默认false；
**canOpenLink**：判断是否可以访问，如果可以访问再拉起应用，在module.json5文件中的querySchemes字段配置。 [参考链接](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/canopenlink-V5) 

### App LInking 

适用场景：
- 扫码直达、社交分享、沉默唤醒、广告引流等；
- 安全性要求较高的场景
- 体验要求较高的应用，不管是否安装都可以正常访问链接；

# 进程模型 

![进程模型示意图](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20250217164512.25116533531025002269847165057892:50001231000000:2800:CEC98A8B608DAFF069FA228DD53181EACE375392EF8C1C79B02B53842FAB9433.png?needInitFileName=true?needInitFileName=true) 

# 线程模型 

![线程模型](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20250217164512.68595483354009894245028499416935:50001231000000:2800:082198D19AC7B365C304635F600E8B39D353C26CA3FD77BEC55C7C94F0377F8A.png?needInitFileName=true?needInitFileName=true) 

