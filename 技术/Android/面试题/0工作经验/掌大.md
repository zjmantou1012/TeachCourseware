---
author: zjmantou
title: 掌大
time: 2025-05-23 周五
tags:
  - 面试
---
# 工作内容

- B端模块：企业主页、企业代理、任务包、生命周期、新手体验营、寝室体验官、开单奖励
- 搜索模块：搜索架构设计、搜索跳转、页面分离、搜索类型扩展、本地存储
	- 商城搜索、店铺搜索、店铺首页、社区搜索、活动搜索
- 社交：寝室派对、在线匹配、动态列表、详情、发送
- 社区：广场推荐卡片流（其他卡片抽象，统一管理卡片adapter）、社区搜索、图文详情（评论组件）
- 
- 
- 组件：优惠券、搜索框、引入Lottie动画、价格字样、新手引导页组件、统计表（贝塞尔曲线）、九宫格图片选择/预览、日历翻页效果的时钟、仿iOS滚动单选、图钉卡片、聊天气泡（shapeModel）,自定义SnapHelper实现轮播只能单个滑动；

# 架构设计

- MVI架构：View 与 ViewModel通信：StateFlow、SharedFlow、Channel，聚合页：分页加载、tab
- 引入jetpack：navigation，ktx，datastore、Paging3、Room，m3主题、
- 单一数据源设计思想
- 工程结构：减少层级，抽离数仓、网络、图片、模块通信、中间件、埋点等、IM解耦

# 框架设计

- 基于阿里云SLS埋点，（字段分散，平铺、页面定位不准确）及V2埋点平台设计（SPM）[文档链接](https://alidocs.dingtalk.com/i/nodes/14lgGw3P8vK9ZOEOsDkZAZlaW5daZ90D)
- Sentry 监控平台：异常堆栈（源码映射）、页面启动时间、ANR、事件最终（点击、日志、跳转）、录频（截图）
- 自动化测试框架搭建：重要的函数、UI逻辑；

# 性能优化
## 首页列表卡顿优化

Perffeto、 RV FullInvalidate、动画进程一致在，GPU渲染模式

- RenderScript、RenderEffect替代三方模糊库；
## 包体积优化

Android Studio App分析工具：去掉无用的so库，so压缩打包，图片转Webp，Webp压缩网站，icon用svg替代；xml文件实现骨架图，替换纯图片；去除不必要的插件（didichuxing）
## 编译优化

遵循官方编译优化文档

build Analyzer 分析器

- 避免使用xx+版本，使用固定版本
- Kotlin增量、并行编译，编译缓存；
- 升级AGP：8.2
- 使用G1垃圾回收器（引入Sentry后，原来的UseParallelGC涨了20多妙）；
- 增加JVM大小：org.gradle.jvmargs=-Xmx6g
- ksp（Glide）
- 不必要的API改成Implemention

### 解决构建失败问题：

- kotlin-stdlib-jdk7与8冲突，查看依赖关系找到发现tui有个依赖库用到了kotlin，但是本身build.gradle没有引入kotlin插件
- mergeDebugAndroidTestNativeLibs：2 file so问题，so重复，在module库中测试时也需要用 `packagingOptions{pickFirsts}` 去重复 
- 腾讯的qqappid在[processDebugUnitTestManifest中找不到](https://issuetracker.google.com/issues/266967487) :
```groovy
android{  
    //module库中用到了腾讯分享的open_sdk_3.5.14.3_rc26220c_lite.jar包，测试时需要手动合并manifest  
    //错误链接 "https://issuetracker.google.com/issues/266967487"    testVariants.configureEach {  
        mergedFlavor.manifestPlaceholders += [  
                qqappid: "101743869",  
        ]  
    }    unitTestVariants.configureEach {  
        mergedFlavor.manifestPlaceholders += [  
                qqappid: "101743869",  
        ]  
    }
}
```
- 其他一些杂七杂八的问题

全量构建速度**1分**以内

全量编译时间在2分以内了，明天可以改下GC 回收器，再分析下每个task的具体执行时间，应该还能缩短一些。

## 图片内存优化

- 自适应高度图片：adjustViewBounds，scaleType=fitXY
- 避免加载原图，抽离Glide库，使用中间库暴露方法，避免乱用；
- 去掉镜像图


# 鸿蒙开发

# 遇到的问题

## BottomSheet

### 无法下滑关闭

因为RecyclerView、Viewpager拦截，禁用掉之后就可以

### 折叠后露出顶部

看源码后设置`paddingBottomSystemWindowInsets=true` 

## JsBridge ANR

在WebClient回调中加了同步锁。—— perfetto发现

