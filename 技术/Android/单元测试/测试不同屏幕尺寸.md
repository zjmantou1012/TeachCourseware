---
author: zjmantou
title: 测试不同屏幕尺寸
time: 2024-08-28 周三
tags:
  - Android
  - 单元测试
---
[官方文档](https://developer.android.com/training/testing/different-screens/tools?hl=zh-cn)
[测试其他组件](https://developer.android.com/training/testing/other-components/content-providers?hl=zh-cn)

- 视觉效果
- 变更后数据的保留

![Now In Android 中的“为您推荐”界面（采用不同窗口大小）](https://developer.android.com/static/images/training/testing/different-screens/nia_sizes.png?hl=zh-cn)

Espresso中，调用`Activity.recreate()` 模式配置更改，页面重建。 

测试从一个屏幕切换到另一个屏幕或者进入多窗口模式（比如：折叠屏打开）
- 使用任意设备在测试期间调整屏幕大小。
- 使用支持您要测试的功能的设备或模拟器，触发相关配置更改。 

测试类型：
- 界面行为测试。
- 屏幕截图测试。

# 库和工具 

## DeviceConfigurationOverride 

```kotlin
   DeviceConfigurationOverride(
        DeviceConfigurationOverride.ForcedSize(DpSize(1280.dp, 800.dp))
    ) {
        MyScreen() // Will be rendered in the space for 1280dp by 800dp without clipping.
    }
```

![使用 DeviceConfigurationOverride 让平板电脑布局适应尺寸较小的设备，如 \*Now in Android* 所示](https://developer.android.com/static/images/training/testing/different-screens/nia_DeviceConfigurationOverride.png?hl=zh-cn)

## Robolectric 

```kotlin
@RunWith(RobolectricTestRunner::class)
// Configure Robolectric to use a very large screen size that can fit all of the test sizes.
// This allows enough room to render the content under test without clipping or scaling.
@Config(qualifiers = "w1000dp-h1000dp-480dpi")
class NiaAppScreenSizesScreenshotTests { ... }
```

```kotlin
val (width, height, dpi) = ...

// Set qualifiers from specs.
RuntimeEnvironment.setQualifiers("w${width}dp-h${height}dp-${dpi}dpi")
```

可以参考[_Now in Android_](https://github.com/android/nowinandroid/blob/main/core/testing/src/main/kotlin/com/google/samples/apps/nowinandroid/core/testing/util/ScreenshotHelper.kt#L61) 示例. 

Robolectric [设备配置](https://robolectric.org/device-configuration/)文档. 

## Gradle管理设备

[Gradle 管理的设备](https://developer.android.com/studio/test/gradle-managed-devices?hl=zh-cn) (GMD) Android Gradle 插件 您可以定义模拟器和真实设备的规格 [插桩](https://developer.android.com/training/testing/instrumented-tests?hl=zh-cn)测试所运行的测试. 

可以在 [testing-samples](https://github.com/android/testing-samples/blob/main/ui/espresso/BasicSample/app/build.gradle) 项目中找到多个 GMD 示例。