---
author: zjmantou
title: TCPIP
time: 2023-09-15 周五
tags:
  - 网络协议
  - TCP
  - UDP
---
# TCP
定义：Transmission Control Protocol，即传输控制协议，是一种传输层通信协议。
	基于TCP的应用层协议有FTP、Telnet、SMTP、HTTP、POP3与DNS。
## 特点
**面向连接、面向字节流、全双工通信、可靠**

- **面向连接**：指的是要使用TCP传输数据，必须先建立TCP连接，传输完成后释放连接，就像打电话一样必须先拨号建立一条连接，打完后挂机释放连接。
- **全双工通信**：即一旦建立了TCP连接，通信双方可以在任何时候都能发送数据。 
- **可靠的**：指的是通过TCP连接传送的数据，无差错，不丢失，不重复，并且按序到达。 
- **面向字节流**：流，指的是流入到进程或从进程流出的字符序列。简单来说，虽然有时候要传输的数据流太大，TCP报文长度有限制，不能一次传输完，要把它分为好几个数据块，但是由于可靠性保证，接收方可以按顺序接收数据块然后重新组成分块之前的数据流，所以TCP看起来就像直接互相传输字节流一样，面向字节流。

## 建立连接
### 三次握手
- 第一次握手：建立连接。客户端发送连接请求报文段，将SYN位置为1，Sequence Number为x；然后，客户端进入SYN_SEND状态，等待服务器的确认。即A发送信息给B
- 第二次握手：服务器收到客户端的SYN报文段，需要对这个SYN报文段进行确认。即B收到连接信息后向A返回确认信息
- 第三次握手：客户端收到服务器的（SYN+ACK）报文段，并向服务器发送ACK报文段。即A收到确认信息后再次向B返回确认连接信息

![三次握手](https://zjmantou-drawingbed.oss-cn-hangzhou.aliyuncs.com/picture/202309151633783.png)


#### 为什么要三次握手

防止接收到失效的连接请求，从而一直等待客户端请求造成资源浪费。

## 释放连接
### 四次挥手

- 第一次挥手：A发送释放信息到B；（发出去之后，A->B发送数据这条路径就断了）；
- 第二次挥手：B收到A的释放信息之后，回复确认释放的信息：我同意你的释放连接请求；
- 第三次挥手：B发送“请求释放连接“信息给A；
- 第四次挥手：A收到B发送的信息后向B发送确认释放信息：我同意你的释放连接请求。

![四次挥手](https://zjmantou-drawingbed.oss-cn-hangzhou.aliyuncs.com/picture/202309151636111.png)

#### 为什么需要四次挥手
因为TCP是全双工的，要确保双方都不能接收到对方的请求


# UDP
定义：User Datagram Protocol，即用户数据报协议，是一种传输层通信协议。
	基于UDP的应用层协议有TFTP、SNMP与DNS。
## 特点
**无连接的、不可靠的、面向报文、没有拥塞控制  **

- **无连接的**：和TCP要建立连接不同，UDP传输数据不需要建立连接，就像写信，在信封写上收信人名称、地址就可以交给邮局发送了，至于能不能送到，就要看邮局的送信能力和送信过程的困难程度了。
    
- **不可靠的**：因为UDP发出去的数据包发出去就不管了，不管它会不会到达，所以很可能会出现丢包现象，使传输的数据出错。
    
- **面向报文**：数据报文，就相当于一个数据包，应用层交给UDP多大的数据包，UDP就照样发送，不会像TCP那样拆分。
    
- **没有拥塞控制**：拥塞，是指到达通信子网中某一部分的分组数量过多，使得该部分网络来不及处理，以致引起这部分乃至整个网络性能下降的现象，严重时甚至会导致网络通信业务陷入停顿，即出现死锁现象，就像交通堵塞一样。TCP建立连接后如果发送的数据因为信道质量的原因不能到达目的地，它会不断重发，有可能导致越来越塞，所以需要一个复杂的原理来控制拥塞。而UDP就没有这个烦恼，发出去就不管了。

## 应用场景
实时应用（IP电话、实时视频会议、多人在线游戏）

## 如何保证UDP传输可靠性

参照TCP的可靠性传输

- 添加seq/ack机制，确保数据发送到对端。
- 添加发送和接收缓冲区，主要是用户超时重传。
- 添加超时重传机制。

目前有如下开源程序利用udp实现了可靠的数据传输。分别为RUDP、RTP、UDT:
### 1、RUDP（Reliable User Datagram Protocol）
RUDP 提供一组数据服务质量增强机制，如拥塞控制的改进、重发机制及淡化服务器算法等。
### 2、RTP（Real Time Protocol）
RTP为数据提供了具有实时特征的端对端传送服务，如在组播或单播网络服务下的交互式视频音频或模拟数据。
### 3、UDT（UDP-based Data Transfer Protocol）
UDT的主要目的是支持高速广域网上的海量数据传输。
